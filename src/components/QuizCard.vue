<template>
  <div class="que-card">
    <div v-if="currentQuestion < 6">
      <div>
        {{ question.question }}
      </div>

      <img v-bind:src="question.image" alt=""/>


      <button v-on:click="click1">
        {{ question.answer1 }}
      </button>
      <button v-on:click="click2">
        {{ question.answer2 }}
      </button>
      <button v-on:click="click3">
        {{ question.answer3 }}
      </button>
      <button v-on:click="click4">
        {{ question.answer4 }}
      </button>
    </div>

    <div v-else>
      <div>
        You got {{userPoints}} points. You are rad!
      </div>
    </div>
  </div>

</template>

<script>

import QuizGame from "@/components/QuizGame";

export default {

  name: "QuizCard",
  QuizGame,
  data() {
    return {
      question: JSON.parse(localStorage.getItem('question1')),
      correctAnswer: 0,
      userPoints: 0,
      currentQuestion: 1
    }
  },
  methods: {
    click1() {
      this.checkAnswer(1)
    },
    click2() {
      this.checkAnswer(2)
    },
    click3() {
      this.checkAnswer(3)
    },
    click4() {
      this.checkAnswer(4)
    },
    checkAnswer(userAnswer) {

      this.correctAnswer = this.question.correct_answer
      if (userAnswer == this.correctAnswer) {
        this.userPoints++
      }

      if (this.currentQuestion < 5) {
        this.currentQuestion++
        this.question = JSON.parse(localStorage.getItem('question' + this.currentQuestion))
      } else {
        this.currentQuestion = 6;
        this.returnScoreToBackend()
      }
    },
    returnScoreToBackend() {
      let userId = localStorage.getItem('userId')

      const jsonData = {'userId': userId, 'userScore': this.userPoints, 'quizId': this.question.quiz_id}
      let options = {
        method: 'POST',
        mode: 'cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(jsonData)
      }
      fetch('http://127.0.0.1:3000/endgame', options)
    }

  }

}


</script>

<style scoped>
.que-card.que-card {
  padding: 20px;
  width: 250px;
  cursor: pointer;
  border: 1px solid #39495c;
  margin-bottom: 18px;
  align-items: center;
  align-content: center;
}


#questionBlock {
  font-size: 30px;
  color: white;
  text-shadow: 3px 3px 0 #000,
  -1px -1px 0 #000,
  1px -1px 0 #000,
  -1px 1px 0 #000,
  1px 1px 0 #000;
}
</style>